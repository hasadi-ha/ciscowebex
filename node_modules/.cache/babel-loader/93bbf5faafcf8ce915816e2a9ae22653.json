{"ast":null,"code":"/**!\n * lib/keyobject.js -- KMS Key Representation\n *\n * Copyright (c) 2015 Cisco Systems, Inc. See LICENSE file.\n */\n\"use strict\";\n\nvar cloneDeep = require(\"lodash.clonedeep\"),\n    jose = require(\"node-jose\");\n\nfunction KMSKeyObject(rep) {\n  rep = cloneDeep(rep || {}); // coerce date fields\n\n  [\"createDate\", \"expirationDate\", \"bindDate\"].forEach(function (f) {\n    if (f in rep && rep[f]) {\n      rep[f] = \"string\" === typeof rep[f] ? new Date(Date.parse(rep[f])) : rep[f];\n    }\n  });\n  Object.defineProperty(this, \"uri\", {\n    get: function () {\n      return rep.uri || \"\";\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, \"jwk\", {\n    get: function () {\n      return rep.jwk || undefined;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, \"userId\", {\n    get: function () {\n      return rep.userId || \"\";\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, \"clientId\", {\n    get: function () {\n      return rep.clientId || \"\";\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, \"createDate\", {\n    get: function () {\n      return rep.createDate || undefined;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, \"expirationDate\", {\n    get: function () {\n      return rep.expirationDate || undefined;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, \"bindDate\", {\n    get: function () {\n      return rep.bindDate || undefined;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, \"resourceUri\", {\n    get: function () {\n      return rep.resourceUri || \"\";\n    },\n    enumerable: true\n  });\n} // ### Instance Methods ###\n\n\nKMSKeyObject.prototype.asKey = function () {\n  if (!this.jwk) {\n    return Promise.reject(new Error(\"'jwk' not set\"));\n  }\n\n  return jose.JWK.asKey(this.jwk);\n};\n\nKMSKeyObject.prototype.toJSON = function () {\n  var self = this,\n      json = {};\n  Object.keys(this).forEach(function (f) {\n    var v = self[f];\n\n    if (\"function\" === typeof v || \"undefined\" === typeof v) {\n      return;\n    }\n\n    if (v instanceof Date) {\n      v = v.toISOString();\n    }\n\n    json[f] = cloneDeep(v);\n  });\n  return json;\n}; // ### Class Functions ###\n\n\nKMSKeyObject.fromObject = function (rep) {\n  if (!rep) {\n    throw new TypeError(\"representation required\");\n  }\n\n  if (rep instanceof KMSKeyObject) {\n    return rep;\n  }\n\n  return new KMSKeyObject(rep);\n};\n\nmodule.exports = KMSKeyObject;","map":null,"metadata":{},"sourceType":"script"}